"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("axios"),t=require("qs");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=o(e),r=o(t),n={routerChange:function(){},tipMessage:function(e){alert(e)},timeout:3e5,hasToken:!1,tokenError:1010},a=s.default.create(n);function c(e,t){const o=sessionStorage.getItem("token");n.hasToken&&!o&&l();const s=n.hasToken?{token:o}:{};let c=r.default.stringify(Object.assign({},s,t));const i=e;return new Promise(((e,t)=>{a.get(i+"?"+c).then((t=>{const o=t.data;o.code==n.tokenError?(u(o.desc),sessionStorage.clear(),localStorage.clear(),l()):e(o)})).catch((e=>{t(e.data)}))}))}function i(e,t){const o=sessionStorage.getItem("token");n.hasToken&&!o&&l();const s=n.hasToken?{token:o}:{};let c=r.default.stringify(Object.assign({},s,t));const i=e;return new Promise(((e,t)=>{a.post(i,c).then((t=>{const o=t.data;o.code==n.tokenError?(u(o.desc),sessionStorage.clear(),localStorage.clear(),l()):e(o)})).catch((e=>{t(e.data)}))}))}a.interceptors.request.use((e=>{if(n.hasToken){const t=sessionStorage.getItem("token");t&&(e.headers.Authorization=t)}return e}),(e=>Promise.error(e))),a.interceptors.response.use((e=>200===e.status?Promise.resolve(e):Promise.reject(e)),(e=>{const{response:t}=e;return t?(g(t.status,t.data.message),Promise.reject(t)):Promise.reject(e)}));const u=e=>{n.tipMessage(e)},l=()=>{n.routerChange()},g=(e,t)=>{switch(e){case 401:l();break;case n.tokenError:u("登录信息已过期，请重新登录！"),sessionStorage.removeItem("token"),setTimeout((()=>{l()}),1e3);break;case 404:u("请求的资源不存在");break;case 500:u("服务器出错");break;default:console.log(t)}};let d={install:function(e){e.prototype.$post=i,e.prototype.$get=c}};d.defaultConfig=n,exports.default=d;
