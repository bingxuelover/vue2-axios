"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("axios"),t=require("qs");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=s(e),r=s(t),a=Object.assign({routerChange:function(){},tipMessage:function(e){alert(e)},timeout:3e5,hasToken:!1,tokenError:1010,baseURL:""},o.default.defaults),n=o.default.create(a);function c(e,t){const s=sessionStorage.getItem("token");a.hasToken&&!s&&l();const o=a.hasToken?{token:s}:{};let c=r.default.stringify(Object.assign({},o,t));const i=a.baseURL+e;return new Promise(((e,t)=>{n.get(i+"?"+c).then((t=>{const s=t.data;s.code==a.tokenError?(u(s.desc),sessionStorage.clear(),localStorage.clear(),l()):e(s)})).catch((e=>{t(e.data)}))}))}function i(e,t){const s=sessionStorage.getItem("token");a.hasToken&&!s&&l();const o=a.hasToken?{token:s}:{};let c=r.default.stringify(Object.assign({},o,t));const i=a.baseURL+e;return new Promise(((e,t)=>{n.post(i,c).then((t=>{const s=t.data;s.code==a.tokenError?(u(s.desc),sessionStorage.clear(),localStorage.clear(),l()):e(s)})).catch((e=>{t(e.data)}))}))}n.interceptors.request.use((e=>{if(a.hasToken){const t=sessionStorage.getItem("token");t&&(e.headers.Authorization=t)}return e}),(e=>Promise.error(e))),n.interceptors.response.use((e=>200===e.status?Promise.resolve(e):Promise.reject(e)),(e=>{const{response:t}=e;return t?(g(t.status,t.data.message),Promise.reject(t)):Promise.reject(e)}));const u=e=>{a.tipMessage(e)},l=()=>{a.routerChange()},g=(e,t)=>{switch(e){case 401:l();break;case a.tokenError:u("登录信息已过期，请重新登录！"),sessionStorage.removeItem("token"),setTimeout((()=>{l()}),1e3);break;case 404:u("请求的资源不存在");break;case 500:u("服务器出错");break;default:console.log(t)}};let d={install:function(e){e.prototype.$post=i,e.prototype.$get=c}};d.defaultConfig=a,exports.default=d;
